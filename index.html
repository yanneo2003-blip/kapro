<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TextCard Pro - Ultimate Edition</title>
    
    <!-- React & DOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Export Libs -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html-to-image/1.11.11/html-to-image.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>

    <!-- Fonts: Noto Sans/Serif SC, JetBrains Mono, Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&family=Noto+Sans+SC:wght@300;400;500;700;900&family=Noto+Serif+SC:wght@400;700&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['"Noto Sans SC"', '-apple-system', 'BlinkMacSystemFont', 'sans-serif'],
                        serif: ['"Noto Serif SC"', 'serif'],
                        mono: ['"JetBrains Mono"', 'Menlo', 'monospace'],
                        ios: ['-apple-system', 'BlinkMacSystemFont', '"San Francisco"', 'sans-serif'],
                    },
                    colors: {
                        ios: { yellow: '#eeb212', bg: '#ffffff', text: '#1c1c1e', date: '#8a8a8e', line: '#e5e5ea' },
                        gh: { bg: '#0d1117', border: '#30363d', text: '#c9d1d9', header: '#161b22', blue: '#58a6ff' },
                        win: { bg: '#f3f3f3', active: '#ffffff', border: '#e5e5e5' },
                        linear: { bg: '#08080a', border: '#222226', text: '#eeeeee' }
                    },
                    boxShadow: {
                        'card-float': '0 20px 40px -10px rgba(0,0,0,0.15), 0 0 1px rgba(0,0,0,0.1)',
                    }
                }
            }
        }
    </script>
    <style>
        body { background-color: #f2f2f7; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        #export-stage { position: fixed; left: -9999px; top: 0; pointer-events: none; }
        .paper-texture {
            background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.03'/%3E%3C/svg%3E");
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- 1. Icons ---
        const Icons = {
            IOSBack: () => <svg width="22" height="22" viewBox="0 0 24 24" fill="none"><path d="M14 18L8 12L14 6" stroke="#eeb212" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"/></svg>,
            IOSShare: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#eeb212" strokeWidth="2"><path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"/><polyline points="16 6 12 2 8 6"/><line x1="12" y1="2" x2="12" y2="15"/></svg>,
            IOSMore: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#eeb212" strokeWidth="2"><circle cx="12" cy="12" r="10"/><path d="M8 12h.01"/><path d="M12 12h.01"/><path d="M16 12h.01"/></svg>,
            NotionMenu: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#37352f" strokeWidth="2"><path d="M3 12h18"/><path d="M3 6h18"/><path d="M3 18h18"/></svg>,
            GHCode: () => <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" className="text-gray-500"><path d="M4.72 3.22a.75.75 0 011.06 1.06L2.06 8l3.72 3.72a.75.75 0 11-1.06 1.06L.47 8.53a.75.75 0 010-1.06l4.25-4.25zm6.56 0a.75.75 0 10-1.06 1.06L13.94 8l-3.72 3.72a.75.75 0 101.06 1.06l4.25-4.25a.75.75 0 000-1.06l-4.25-4.25z"></path></svg>,
            WinClose: () => <svg width="10" height="10" viewBox="0 0 10 10" stroke="#000" strokeWidth="1"><path d="M0 0L10 10M10 0L0 10"/></svg>,
            Wifi: () => <svg width="18" height="14" viewBox="0 0 18 14" fill="none"><path d="M9 11.5C9.5 11.5 10 11 10 10.5C10 10 9.5 9.5 9 9.5C8.5 9.5 8 10 8 10.5C8 11 8.5 11.5 9 11.5Z" fill="#1c1c1e"/><path d="M13.5 7.5C13.5 7.5 11.5 5.5 9 5.5C6.5 5.5 4.5 7.5 4.5 7.5" stroke="#1c1c1e" strokeWidth="1.5" strokeLinecap="round"/><path d="M16.5 4.5C16.5 4.5 12.5 1.5 9 1.5C5.5 1.5 1.5 4.5 1.5 4.5" stroke="#1c1c1e" strokeWidth="1.5" strokeLinecap="round"/></svg>,
            Battery: () => <svg width="24" height="12" viewBox="0 0 24 12"><rect x="1" y="1" width="20" height="10" rx="2" stroke="#1c1c1e" fill="none"/><rect x="3" y="3" width="16" height="6" rx="1" fill="#1c1c1e"/><path d="M23 4v4" stroke="#1c1c1e" strokeLinecap="round"/></svg>,
            MacOptions: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="1"/><circle cx="19" cy="12" r="1"/><circle cx="5" cy="12" r="1"/></svg>
        };

        // --- 2. Configurations ---
        
        const FONTS = [
            { id: 'sans', name: 'ÊÄùÊ∫êÈªë‰Ωì', class: 'font-sans' },
            { id: 'serif', name: 'ÊÄùÊ∫êÂÆã‰Ωì', class: 'font-serif' },
            { id: 'mono', name: 'Á≠âÂÆΩÂ≠ó‰Ωì', class: 'font-mono' },
        ];

        const SPACINGS = [
            { id: 'tight', name: 'Á¥ßÂáë', leading: 'leading-normal', margin: 'mb-3' },
            { id: 'normal', name: 'ÈÄÇ‰∏≠', leading: 'leading-relaxed', margin: 'mb-5' },
            { id: 'loose', name: 'ËàíÊúó', leading: 'leading-loose', margin: 'mb-8' },
        ];

        const SIZES = {
            sm: { id: 'sm', val: 'text-[22px]', label: 'Â∞è' },
            md: { id: 'md', val: 'text-[28px]', label: '‰∏≠' },
            lg: { id: 'lg', val: 'text-[36px]', label: 'Â§ß' }
        };

        // THEMES Updated
        const THEMES = [
            { id: 'ios', name: 'iOS Â§áÂøòÂΩï', bg: '#ffffff', type: 'light' }, // Fixed: Background White
            { id: 'notion', name: 'Notion', bg: '#ffffff', type: 'light' },
            { id: 'mac', name: 'MacOS', bg: '#ffffff', type: 'light' }, // MacOS window body is white usually
            { id: 'github', name: 'GitHub', bg: '#0d1117', type: 'dark' },
            { id: 'win11', name: 'Windows 11', bg: '#f3f3f3', type: 'light' },
            { id: 'linear', name: 'Linear', bg: '#08080a', type: 'dark' }
        ];

        // --- 3. Aesthetic Headers ---
        
        const HeaderIOS = ({ title, date }) => (
            <div className="relative bg-white pt-2 paper-texture border-b border-[#e5e5ea]">
                <div className="flex justify-between items-center px-6 py-2 text-[12px] font-bold tracking-wide text-gray-900 mb-2">
                    <span>9:41</span>
                    <div className="flex items-center space-x-2"><Icons.Wifi /><Icons.Battery /></div>
                </div>
                <div className="px-5 flex justify-between items-center mb-6">
                    <div className="flex items-center space-x-1 text-ios-yellow cursor-pointer">
                        <Icons.IOSBack />
                        <span className="text-[17px] leading-none">Êñá‰ª∂Â§π</span>
                    </div>
                    <div className="flex items-center space-x-4 text-ios-yellow">
                        <Icons.IOSShare /><Icons.IOSMore />
                    </div>
                </div>
                <div className="px-6 pb-4">
                    <h1 className="text-[34px] font-bold text-gray-900 leading-tight mb-2 tracking-tight">{title}</h1>
                    <p className="text-[#8a8a8e] text-[14px] font-medium">{date}</p>
                </div>
            </div>
        );

        const HeaderNotion = ({ title, date }) => (
            <div className="relative bg-white group">
                <div className="absolute top-3 right-4 flex space-x-4 opacity-40 z-20"><Icons.NotionMenu /></div>
                <div className="h-32 bg-gradient-to-r from-[#ff9a9e] to-[#fecfef] w-full"></div>
                <div className="px-10 -mt-10 relative z-10">
                    <div className="text-[72px] leading-none mb-4 drop-shadow-sm">üìù</div>
                    <h1 className="text-[38px] font-bold text-[#37352f] tracking-tight leading-tight mb-4">{title}</h1>
                    <div className="space-y-1 mb-8">
                        <div className="flex items-center text-[14px]">
                            <span className="w-24 text-[#9b9a97]">Created</span><span className="text-[#37352f]">{date}</span>
                        </div>
                    </div>
                    <hr className="border-gray-200" />
                </div>
            </div>
        );

        // Updated GitHub Header (Simplified)
        const HeaderGitHub = ({ title, author }) => (
            <div className="bg-[#0d1117] pt-6 px-6">
                <div className="flex items-center text-sm text-[#7d8590] mb-4 font-mono">
                    <span className="text-blue-400 font-semibold">{author || 'user'}</span><span className="mx-1">/</span><span className="font-bold text-[#c9d1d9]">{title}</span>
                    <span className="ml-2 border border-[#30363d] rounded-full px-2 text-xs text-[#7d8590]">Public</span>
                </div>
                <div className="bg-[#161b22] border border-[#30363d] border-b-0 rounded-t-md px-4 py-2 flex justify-between items-center text-xs text-[#7d8590]">
                    <div className="flex items-center space-x-3"><Icons.GHCode /><span className="font-mono font-semibold text-[#c9d1d9]">{title}.md</span></div>
                </div>
            </div>
        );

        // Updated MacOS Header (More authentic window style)
        const HeaderMac = ({ title }) => (
            <div className="bg-[#f1f1f1] border-b border-[#dadada] rounded-t-xl">
                <div className="h-[52px] flex items-center px-5 relative">
                    {/* Traffic Lights */}
                    <div className="flex space-x-2 absolute left-5">
                        <div className="w-3 h-3 rounded-full bg-[#ff5f56] border border-[#e0443e]"></div>
                        <div className="w-3 h-3 rounded-full bg-[#ffbd2e] border border-[#dea123]"></div>
                        <div className="w-3 h-3 rounded-full bg-[#27c93f] border border-[#1aab29]"></div>
                    </div>
                    
                    {/* Centered Title */}
                    <div className="flex-1 flex justify-center space-x-2 items-center text-gray-500 font-semibold text-[13px] opacity-80">
                         <span className="truncate max-w-[200px]">{title}</span>
                    </div>
                </div>
                {/* Toolbar */}
                <div className="h-8 bg-white border-t border-[#f1f1f1] flex items-center px-4 space-x-6 text-xs text-gray-500 font-medium">
                     <span>File</span><span>Edit</span><span>View</span>
                </div>
            </div>
        );

        const HeaderWin11 = ({ title }) => (
            <div className="bg-[#f3f3f3] relative border-b border-[#e5e5e5]">
                <div className="flex justify-between items-center h-[32px] px-3">
                    <div className="flex items-center space-x-2 text-xs"><img src="https://upload.wikimedia.org/wikipedia/commons/9/96/Microsoft_Notepad_icon_%282022%29.png" width="14" /><span className="text-gray-500">Notepad</span></div>
                    <div className="flex space-x-4 text-gray-400 scale-75 origin-right"><div className="w-3 h-3 border border-gray-400"></div><Icons.WinClose /></div>
                </div>
                <div className="flex items-end px-2 space-x-1 h-[34px]">
                    <div className="bg-white rounded-t-md px-3 py-1.5 flex items-center space-x-2 text-xs shadow-sm border-t border-x border-gray-200 w-48 relative top-[1px] z-10">
                        <span className="font-medium text-gray-800 truncate">{title}.txt</span><span className="ml-auto text-gray-400 text-[10px]">√ó</span>
                    </div>
                </div>
                <div className="bg-white px-3 py-1.5 flex space-x-4 text-[11px] text-gray-700 border-b border-gray-100 shadow-sm z-0">
                    <span>File</span><span>Edit</span><span>View</span>
                </div>
            </div>
        );

        const HeaderLinear = ({ title, date }) => (
            <div className="px-8 pt-10 pb-6 relative overflow-hidden">
                <div className="absolute top-0 right-0 w-64 h-64 bg-indigo-900/20 blur-[60px] rounded-full pointer-events-none"></div>
                <div className="relative z-10">
                    <div className="flex items-center space-x-3 mb-6">
                        <div className="w-6 h-6 rounded bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center text-[10px] font-bold text-white shadow-lg">T</div>
                        <span className="text-xs font-medium text-gray-500 uppercase tracking-widest">{date}</span>
                    </div>
                    <h1 className="text-3xl font-bold text-transparent bg-clip-text bg-gradient-to-b from-white to-gray-400 mb-2">{title}</h1>
                </div>
            </div>
        );

        // --- 4. Card Component ---
        const Card = React.forwardRef(({ theme, sizeKey, font, spacing, content, pageIndex, totalPages, title, author, wordCount, titleMode }, ref) => {
            const dateStr = new Date().toLocaleDateString('zh-CN', { year: 'numeric', month: '2-digit', day: '2-digit' });
            const sizeConfig = SIZES[sizeKey];

            // Header Render Logic
            const showHeader = pageIndex === 0 || titleMode === 'all';

            const renderHeader = () => {
                if (!showHeader) {
                     // Spacer for non-header pages (small margin)
                    return <div className="h-8"></div>; 
                }
                switch(theme.id) {
                    case 'ios': return <HeaderIOS title={title} date={dateStr} />;
                    case 'notion': return <HeaderNotion title={title} date={dateStr} />;
                    case 'github': return <HeaderGitHub title={title} author={author} />;
                    case 'mac': return <HeaderMac title={title} />;
                    case 'win11': return <HeaderWin11 title={title} />;
                    case 'linear': return <HeaderLinear title={title} date={dateStr} />;
                    default: return <div className="h-12 bg-gray-100"></div>;
                }
            };

            const isGitHub = theme.id === 'github';
            const isLinear = theme.id === 'linear';
            const isWin = theme.id === 'win11';
            const isMac = theme.id === 'mac';

            // Card Style
            const cardStyle = {
                width: '600px',
                height: '800px',
                backgroundColor: isGitHub ? '#0d1117' : isWin ? '#ffffff' : isLinear ? '#08080a' : theme.bg,
                color: isGitHub ? '#c9d1d9' : isLinear ? '#eeeeee' : '#333',
            };

            const borderClass = isGitHub ? 'border border-[#30363d]' : isLinear ? 'border border-[#222226]' : isMac ? 'border border-[#d2d2d2]' : '';
            const trueRadius = isWin ? 'rounded-none' : 'rounded-xl';

            // Shadow
            let shadowStyle = {};
            if (theme.id === 'ios') shadowStyle = { boxShadow: '0 20px 40px rgba(0,0,0,0.1)' };
            if (theme.id === 'notion') shadowStyle = { boxShadow: '0 8px 30px rgba(0,0,0,0.06)' };
            if (theme.id === 'linear') shadowStyle = { boxShadow: '0 0 0 1px #222226, 0 20px 50px -10px rgba(0,0,0,0.5)' };
            if (theme.id === 'mac') shadowStyle = { boxShadow: '0 25px 50px -12px rgba(0,0,0,0.25)' };

            const contentPadding = theme.id === 'notion' && showHeader ? 'px-10 py-2' : isGitHub ? 'px-8 py-6' : 'px-8 py-6';

            return (
                <div ref={ref} className={`relative flex flex-col overflow-hidden ${trueRadius} ${borderClass} ${font.class}`} style={{...cardStyle, ...shadowStyle}}>
                    {renderHeader()}

                    {/* Content Body */}
                    <div className={`flex-1 ${contentPadding} whitespace-pre-wrap break-words text-justify ${sizeConfig.val} ${spacing.leading}`}>
                        {/* Removed Gutter Logic, just plain text div now */}
                        <div className="h-full">
                            {content.map((para, idx) => <p key={idx} className={spacing.margin}>{para}</p>)}
                        </div>
                    </div>

                    {/* Footer */}
                    <div className={`relative z-10 px-6 py-4 flex justify-between items-center text-[10px] uppercase tracking-wider font-medium opacity-60 ${isGitHub || isLinear ? 'text-gray-500 border-t border-white/5' : 'text-gray-400 border-t border-black/5'} ${isWin ? 'bg-[#f3f3f3] h-[28px] py-0 border-t border-[#e5e5e5]' : ''}`}>
                         {isWin ? (
                            <div className="flex items-center space-x-6 w-full text-gray-600 normal-case font-sans">
                                <span>Ln {content.length}, Col 1</span><span>100%</span><span className="ml-auto">Windows (CRLF)</span><span>UTF-8</span>
                            </div>
                        ) : (
                            <>
                                <div className="flex items-center space-x-3">
                                    <span className="font-bold">{author || 'Anonymous'}</span><span>¬∑</span><span>{wordCount} words</span>
                                </div>
                                <div className="flex items-center space-x-1">
                                    <span>{pageIndex + 1}</span><span className="mx-1">/</span><span>{totalPages}</span>
                                </div>
                            </>
                        )}
                    </div>
                </div>
            );
        });

        // --- 5. Main App Logic ---
        const App = () => {
            const [text, setText] = useState("ÁæéÂ≠¶‰∏éÂäüËÉΩÁöÑÂÆåÁæéÁªü‰∏Ä„ÄÇ\n\nTextCard Pro Áé∞Â∑≤ÊîØÊåÅÂÆåÊï¥ÁöÑËá™ÂÆö‰πâÊéíÁâàÁ≥ªÁªü„ÄÇ\n\nÊÇ®ÂèØ‰ª•Ëá™Áî±ÂàáÊç¢ÊÄùÊ∫êÈªë‰Ωì„ÄÅÊÄùÊ∫êÂÆã‰Ωì‰∏éÁ≠âÂÆΩÂ≠ó‰ΩìÔºåÂêåÊó∂Ë∞ÉÊï¥Ë°åÈó¥Ë∑ùÔºàÁ¥ßÂáë„ÄÅÈÄÇ‰∏≠„ÄÅËàíÊúóÔºâ„ÄÇ\n\nÊó†ËÆ∫ÊÇ®ÊòØÈúÄË¶Å GitHub È£éÊ†ºÁöÑ‰ª£Á†ÅÂ±ïÁ§∫ÔºåËøòÊòØ Notion È£éÊ†ºÁöÑÊñáÊ°£ËÆ∞ÂΩïÔºå‰∫¶ÊàñÊòØ iOS È£éÊ†ºÁöÑÂ§áÂøòÂΩïÔºåËøôÈáåÈÉΩËÉΩÂÆåÁæéÂëàÁé∞„ÄÇ");
            const [title, setTitle] = useState("ÊéíÁâàÁæéÂ≠¶");
            const [author, setAuthor] = useState("ËÆæËÆ°Â∏à");
            
            // State
            const [theme, setTheme] = useState(THEMES[0]);
            const [sizeKey, setSizeKey] = useState('md');
            const [font, setFont] = useState(FONTS[0]);      
            const [spacing, setSpacing] = useState(SPACINGS[1]); 
            const [titleMode, setTitleMode] = useState('first'); // 'first' | 'all'

            const [pages, setPages] = useState([]);
            const [previewPage, setPreviewPage] = useState(0);
            const [isExporting, setIsExporting] = useState(false);
            const [exportProgress, setExportProgress] = useState(0);
            const [exportIndex, setExportIndex] = useState(-1);
            
            const measureRef = useRef(null);
            const exportRef = useRef(null);

            // Pagination Engine (Updated to include dynamic header height)
            useEffect(() => {
                if (!measureRef.current) return;
                
                // Height Calculation Helper
                const getSafeHeight = (isFirstPage) => {
                    let h = 120; // Default Header
                    let f = 60;  // Default Footer
                    let p = 40;  // Default Padding

                    // Theme specifics
                    if (theme.id === 'notion') { h = 260; p = 20; }
                    if (theme.id === 'ios') h = 160;
                    if (theme.id === 'github') { h = 140; f = 50; }
                    if (theme.id === 'win11') { h = 110; f = 30; }
                    if (theme.id === 'mac') h = 100;

                    // If it's NOT the first page AND title mode is 'first', header height is minimal
                    if (!isFirstPage && titleMode === 'first') {
                        h = 32; // Just spacing
                    }

                    return 800 - h - f - p;
                };

                const computedPages = [];
                let currentPage = [];
                let currentHeight = 0;

                const measureDiv = measureRef.current;
                const sizeConfig = SIZES[sizeKey];
                
                measureDiv.className = `w-[536px] ${font.class} ${sizeConfig.val} ${spacing.leading} whitespace-pre-wrap break-words`;
                if (theme.id === 'github') measureDiv.style.width = '536px'; // Full width now
                else measureDiv.style.width = theme.id === 'notion' ? '520px' : '536px';

                const paragraphs = text.split('\n');

                // Simulation state
                let isFirstPage = true;
                let maxHeight = getSafeHeight(true);

                paragraphs.forEach((para, index) => {
                    const content = para === '' ? ' ' : para;
                    measureDiv.innerText = content;
                    
                    // Margin Bottom
                    let mb = 20;
                    if (spacing.id === 'tight') mb = 12;
                    if (spacing.id === 'normal') mb = 20;
                    if (spacing.id === 'loose') mb = 32;

                    const h = measureDiv.offsetHeight + mb;

                    if (currentHeight + h > maxHeight && currentPage.length > 0) {
                        computedPages.push(currentPage);
                        currentPage = [para];
                        currentHeight = h;
                        
                        // Next page settings
                        isFirstPage = false;
                        maxHeight = getSafeHeight(false);
                    } else {
                        currentPage.push(para);
                        currentHeight += h;
                    }
                });
                if (currentPage.length > 0) computedPages.push(currentPage);
                setPages(computedPages);
                
                setPreviewPage(p => {
                    if (computedPages.length === 0) return 0;
                    return Math.min(p, computedPages.length - 1);
                });

            }, [text, theme, sizeKey, font, spacing, titleMode]);

            const handleExport = async () => {
                if (pages.length === 0) return;
                setIsExporting(true);
                const zip = new JSZip();
                try {
                    for (let i = 0; i < pages.length; i++) {
                        setExportIndex(i);
                        setExportProgress(Math.round(((i + 1) / pages.length) * 100));
                        await new Promise(r => setTimeout(r, 200));
                        
                        if (exportRef.current) {
                            const blob = await htmlToImage.toBlob(exportRef.current, { 
                                pixelRatio: 2.5, width: 600, height: 800, backgroundColor: null 
                            });
                            zip.file(`card_${i + 1}.png`, blob);
                        }
                    }
                    const content = await zip.generateAsync({ type: "blob" });
                    saveAs(content, `${title}.zip`);
                } catch (e) {
                    console.error(e);
                    alert("Export Error");
                } finally {
                    setIsExporting(false);
                    setExportIndex(-1);
                }
            };

            return (
                <div className="min-h-screen flex flex-col md:flex-row font-sans text-gray-800 bg-[#e5e5ea]">
                    
                    {/* Sidebar */}
                    <div className="w-full md:w-[400px] bg-white border-r border-gray-200 flex flex-col h-screen z-20 shadow-xl">
                        <div className="p-6 border-b border-gray-100 bg-white">
                            <h1 className="text-xl font-bold text-gray-900 tracking-tight">TextCard <span className="text-indigo-600">Ultimate</span></h1>
                        </div>

                        <div className="flex-1 overflow-y-auto p-6 space-y-8 no-scrollbar">
                            
                            {/* Theme Grid */}
                            <div className="space-y-3">
                                <label className="text-xs font-bold text-gray-400 uppercase tracking-wider">È£éÊ†º‰∏ªÈ¢ò</label>
                                <div className="grid grid-cols-2 gap-3">
                                    {THEMES.map(t => (
                                        <button key={t.id} onClick={() => setTheme(t)} className={`relative p-3 rounded-xl border text-left transition-all ${theme.id === t.id ? 'border-indigo-600 ring-1 ring-indigo-600 bg-indigo-50' : 'border-gray-200 hover:border-gray-300'}`}>
                                            <span className="text-sm font-semibold text-gray-700">{t.name}</span>
                                        </button>
                                    ))}
                                </div>
                            </div>

                            {/* Typography Controls */}
                            <div className="space-y-4">
                                <label className="text-xs font-bold text-gray-400 uppercase tracking-wider">ÊéíÁâàËÆæÁΩÆ</label>
                                
                                <div className="flex bg-gray-100 p-1 rounded-lg">
                                    {FONTS.map(f => (
                                        <button key={f.id} onClick={() => setFont(f)} className={`flex-1 py-1.5 text-xs font-medium rounded-md transition-all ${font.id === f.id ? 'bg-white shadow-sm text-indigo-600' : 'text-gray-500'}`}>
                                            {f.name}
                                        </button>
                                    ))}
                                </div>

                                <div className="flex bg-gray-100 p-1 rounded-lg">
                                    {Object.entries(SIZES).map(([key, config]) => (
                                        <button key={key} onClick={() => setSizeKey(key)} className={`flex-1 py-1.5 text-xs font-medium rounded-md transition-all ${sizeKey === key ? 'bg-white shadow-sm text-indigo-600' : 'text-gray-500'}`}>
                                            {config.label}
                                        </button>
                                    ))}
                                </div>

                                <div className="flex bg-gray-100 p-1 rounded-lg">
                                    {SPACINGS.map(s => (
                                        <button key={s.id} onClick={() => setSpacing(s)} className={`flex-1 py-1.5 text-xs font-medium rounded-md transition-all ${spacing.id === s.id ? 'bg-white shadow-sm text-indigo-600' : 'text-gray-500'}`}>
                                            {s.name}
                                        </button>
                                    ))}
                                </div>

                                {/* Title Mode Toggle */}
                                <div className="flex items-center justify-between p-3 bg-gray-50 rounded-lg border border-gray-100">
                                    <span className="text-xs font-medium text-gray-600">Ê†áÈ¢òÊØèÈ°µÊòæÁ§∫</span>
                                    <button 
                                        onClick={() => setTitleMode(m => m === 'first' ? 'all' : 'first')}
                                        className={`w-10 h-5 rounded-full p-0.5 transition-colors ${titleMode === 'all' ? 'bg-indigo-600' : 'bg-gray-300'}`}
                                    >
                                        <div className={`w-4 h-4 bg-white rounded-full shadow-sm transform transition-transform ${titleMode === 'all' ? 'translate-x-5' : 'translate-x-0'}`}></div>
                                    </button>
                                </div>
                            </div>

                            {/* Content Inputs */}
                            <div className="space-y-4">
                                <label className="text-xs font-bold text-gray-400 uppercase tracking-wider">ÂÜÖÂÆπÁºñËæë</label>
                                <input value={title} onChange={e => setTitle(e.target.value)} className="w-full px-4 py-2 bg-gray-50 border border-gray-200 rounded-lg focus:ring-2 focus:ring-indigo-500/20 outline-none font-bold text-gray-800" placeholder="Ê†áÈ¢ò" />
                                <div className="flex gap-2">
                                    <input value={author} onChange={e => setAuthor(e.target.value)} className="flex-1 px-4 py-2 bg-gray-50 border border-gray-200 rounded-lg focus:ring-2 focus:ring-indigo-500/20 outline-none text-sm" placeholder="‰ΩúËÄÖ" />
                                </div>
                                <textarea value={text} onChange={e => setText(e.target.value)} className="w-full h-40 px-4 py-3 bg-gray-50 border border-gray-200 rounded-lg focus:ring-2 focus:ring-indigo-500/20 outline-none resize-none text-sm leading-relaxed" placeholder="ËØ∑ËæìÂÖ•Ê≠£Êñá..." />
                            </div>
                        </div>

                        <div className="p-6 border-t border-gray-100 bg-gray-50/50">
                            <button onClick={handleExport} disabled={isExporting} className="w-full py-3.5 bg-indigo-600 hover:bg-indigo-700 text-white rounded-xl shadow-lg shadow-indigo-200 flex items-center justify-center gap-2 font-semibold transition-all disabled:opacity-70">
                                {isExporting ? 'ÁîüÊàê‰∏≠...' : 'ÊâìÂåÖ‰∏ãËΩΩÂõæÁâá (.zip)'}
                            </button>
                        </div>
                    </div>

                    {/* Preview Area */}
                    <div className="flex-1 relative flex flex-col items-center justify-center p-8 overflow-hidden bg-[#e5e5ea]">
                         {pages.length > 1 && (
                            <div className="absolute top-6 z-20 flex items-center gap-4 bg-white/80 backdrop-blur px-4 py-2 rounded-full shadow-sm border border-white/40">
                                <button onClick={() => setPreviewPage(p => Math.max(0, p-1))} className="w-6 h-6 flex items-center justify-center rounded-full hover:bg-black/5 text-gray-500">‚Üê</button>
                                <span className="text-xs font-mono font-bold text-gray-600">{previewPage + 1} / {pages.length}</span>
                                <button onClick={() => setPreviewPage(p => Math.min(pages.length-1, p+1))} className="w-6 h-6 flex items-center justify-center rounded-full hover:bg-black/5 text-gray-500">‚Üí</button>
                            </div>
                        )}

                        <div className="transform transition-all duration-300 shadow-2xl origin-top md:origin-center scale-[0.55] sm:scale-[0.65] md:scale-[0.8] lg:scale-[0.95]">
                            {pages.length > 0 ? (
                                <Card 
                                    theme={theme}
                                    sizeKey={sizeKey}
                                    font={font}
                                    spacing={spacing}
                                    content={pages[previewPage]}
                                    pageIndex={previewPage}
                                    totalPages={pages.length}
                                    title={title}
                                    author={author}
                                    wordCount={text.length}
                                    titleMode={titleMode}
                                />
                            ) : <div className="w-[600px] h-[800px] bg-white flex items-center justify-center text-gray-300">Start Typing...</div>}
                        </div>
                    </div>

                    {/* Hidden Measurement & Export */}
                    <div className="fixed -z-50 opacity-0 pointer-events-none">
                        <div ref={measureRef} style={{ width: '600px' }}></div>
                    </div>
                    {isExporting && exportIndex >= 0 && (
                        <div id="export-stage">
                            <Card 
                                ref={exportRef}
                                theme={theme}
                                sizeKey={sizeKey}
                                font={font}
                                spacing={spacing}
                                content={pages[exportIndex]}
                                pageIndex={exportIndex}
                                totalPages={pages.length}
                                title={title}
                                author={author}
                                wordCount={text.length}
                                titleMode={titleMode}
                            />
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>


